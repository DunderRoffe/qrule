// Copyright (C) 2016 Pelagicore
//
// You may use this file under the terms of the GPLv3 license.
// See the file LICENSE from this package for details.
//
// SPDX-License-Identifier: GPL-3.0

/* This Bison file was machine-generated by BNFC */
%{
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <iostream>
#include <algorithm>
#include "Absyn.H"
typedef struct yy_buffer_state *YY_BUFFER_STATE;
int yyparse(void);
int yylex(void);
YY_BUFFER_STATE yy_scan_string(const char *str);
void yy_delete_buffer(YY_BUFFER_STATE buf);
int yy_mylinenumber;
int initialize_lexer(FILE * inp);
int yywrap(void)
{
  return 1;
}
void yyerror(const char *str)
{
  extern char *yytext;
  fprintf(stderr,"error: line %d: %s at %s\n",
    yy_mylinenumber, str, yytext);
}



static RuleSet* YY_RESULT_RuleSet_ = 0;
RuleSet* pRuleSet(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_RuleSet_;
  }
}
RuleSet* pRuleSet(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_RuleSet_;
  }
}

static Rule* YY_RESULT_Rule_ = 0;
Rule* pRule(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Rule_;
  }
}
Rule* pRule(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Rule_;
  }
}

static ASTScope* YY_RESULT_ASTScope_ = 0;
ASTScope* pASTScope(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ASTScope_;
  }
}
ASTScope* pASTScope(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ASTScope_;
  }
}

static RuleCause* YY_RESULT_RuleCause_ = 0;
RuleCause* pRuleCause(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_RuleCause_;
  }
}
RuleCause* pRuleCause(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_RuleCause_;
  }
}

static Explanation* YY_RESULT_Explanation_ = 0;
Explanation* pExplanation(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Explanation_;
  }
}
Explanation* pExplanation(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Explanation_;
  }
}

static ListRule* YY_RESULT_ListRule_ = 0;
ListRule* pListRule(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ListRule_;
  }
}
ListRule* pListRule(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ListRule_;
  }
}

static Tag* YY_RESULT_Tag_ = 0;
Tag* pTag(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Tag_;
  }
}
Tag* pTag(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Tag_;
  }
}

static Severity* YY_RESULT_Severity_ = 0;
Severity* pSeverity(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Severity_;
  }
}
Severity* pSeverity(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Severity_;
  }
}

static PathQuantifier* YY_RESULT_PathQuantifier_ = 0;
PathQuantifier* pPathQuantifier(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_PathQuantifier_;
  }
}
PathQuantifier* pPathQuantifier(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_PathQuantifier_;
  }
}

static IAtom* YY_RESULT_IAtom_ = 0;
IAtom* pIAtom(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_IAtom_;
  }
}
IAtom* pIAtom(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_IAtom_;
  }
}

static SAtom* YY_RESULT_SAtom_ = 0;
SAtom* pSAtom(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_SAtom_;
  }
}
SAtom* pSAtom(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_SAtom_;
  }
}

static Expr* YY_RESULT_Expr_ = 0;
Expr* pExpr(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Expr_;
  }
}
Expr* pExpr(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Expr_;
  }
}

static ListExpr* YY_RESULT_ListExpr_ = 0;
ListExpr* pListExpr(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ListExpr_;
  }
}
ListExpr* pListExpr(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ListExpr_;
  }
}

static Filter* YY_RESULT_Filter_ = 0;
Filter* pFilter(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Filter_;
  }
}
Filter* pFilter(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_Filter_;
  }
}

static ListFilter* YY_RESULT_ListFilter_ = 0;
ListFilter* pListFilter(FILE *inp)
{
  yy_mylinenumber = 1;
  initialize_lexer(inp);
  if (yyparse())
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ListFilter_;
  }
}
ListFilter* pListFilter(const char *str)
{
  YY_BUFFER_STATE buf;
  int result;
  yy_mylinenumber = 1;
  initialize_lexer(0);
  buf = yy_scan_string(str);
  result = yyparse();
  yy_delete_buffer(buf);
  if (result)
  { /* Failure */
    return 0;
  }
  else
  { /* Success */
    return YY_RESULT_ListFilter_;
  }
}



%}

%union
{
  int int_;
  char char_;
  double double_;
  char* string_;
  RuleSet* ruleset_;
  Rule* rule_;
  ASTScope* astscope_;
  RuleCause* rulecause_;
  Explanation* explanation_;
  ListRule* listrule_;
  Tag* tag_;
  Severity* severity_;
  PathQuantifier* pathquantifier_;
  IAtom* iatom_;
  SAtom* satom_;
  Expr* expr_;
  ListExpr* listexpr_;
  Filter* filter_;
  ListFilter* listfilter_;
}

%token _ERROR_
%token _SYMB_0    //   ::
%token _SYMB_1    //   ??
%token _SYMB_2    //
%token _SYMB_3    //   .
%token _SYMB_4    //   (
%token _SYMB_5    //   )
%token _SYMB_6    //   +
%token _SYMB_7    //   !
%token _SYMB_8    //   =
%token _SYMB_9    //   <=
%token _SYMB_10    //   >=
%token _SYMB_11    //   <
%token _SYMB_12    //   >
%token _SYMB_13    //   &
%token _SYMB_14    //   |
%token _SYMB_15    //   :
%token _SYMB_16    //   ->
%token _SYMB_17    //   A
%token _SYMB_18    //   AF
%token _SYMB_19    //   AG
%token _SYMB_20    //   AX
%token _SYMB_21    //   Critical
%token _SYMB_22    //   E
%token _SYMB_23    //   EF
%token _SYMB_24    //   EG
%token _SYMB_25    //   EX
%token _SYMB_26    //   False
%token _SYMB_27    //   File
%token _SYMB_28    //   Globally
%token _SYMB_29    //   Imported
%token _SYMB_30    //   Info
%token _SYMB_31    //   Language
%token _SYMB_32    //   Policy
%token _SYMB_33    //   True
%token _SYMB_34    //   U
%token _SYMB_35    //   Warning
%token _SYMB_36    //   col
%token _SYMB_37    //   exist
%token _SYMB_38    //   existing
%token _SYMB_39    //   forAll
%token _SYMB_40    //   in
%token _SYMB_41    //   is
%token _SYMB_42    //   match
%token _SYMB_43    //   nodeType
%token _SYMB_44    //   nrChildren
%token _SYMB_45    //   possible
%token _SYMB_46    //   row
%token _SYMB_47    //   token
%token _SYMB_48    //   value
%token _SYMB_49    //   valueType

%type <ruleset_> RuleSet
%type <rule_> Rule
%type <astscope_> ASTScope
%type <rulecause_> RuleCause
%type <explanation_> Explanation
%type <listrule_> ListRule
%type <tag_> Tag
%type <severity_> Severity
%type <pathquantifier_> PathQuantifier
%type <iatom_> IAtom2
%type <iatom_> IAtom1
%type <iatom_> IAtom
%type <satom_> SAtom3
%type <satom_> SAtom2
%type <satom_> SAtom1
%type <satom_> SAtom
%type <expr_> Expr10
%type <expr_> Expr9
%type <expr_> Expr7
%type <expr_> Expr6
%type <expr_> Expr4
%type <expr_> Expr3
%type <expr_> Expr2
%type <expr_> Expr
%type <expr_> Expr1
%type <expr_> Expr5
%type <expr_> Expr8
%type <listexpr_> ListExpr
%type <filter_> Filter
%type <listfilter_> ListFilter

%start RuleSet
%token<string_> _STRING_
%token<int_> _INTEGER_
%token<string_> _IDENT_

%%
RuleSet : ListRule {  $$ = new RSet($1); YY_RESULT_RuleSet_= $$; }
;
Rule : Tag Severity RuleCause ASTScope Explanation _SYMB_0 Expr {  $$ = new RRule($1, $2, $3, $4, $5, $7); YY_RESULT_Rule_= $$; }
;
ASTScope : _SYMB_28 {  $$ = new ASTGlobally(); YY_RESULT_ASTScope_= $$; }
  | _SYMB_27 {  $$ = new ASTFile(); YY_RESULT_ASTScope_= $$; }
  | _SYMB_29 {  $$ = new ASTImported(); YY_RESULT_ASTScope_= $$; }
;
RuleCause : _SYMB_31 {  $$ = new RCLang(); YY_RESULT_RuleCause_= $$; }
  | _SYMB_32 {  $$ = new RCPolicy(); YY_RESULT_RuleCause_= $$; }
;
Explanation : _SYMB_1 _STRING_ {  $$ = new Explan($2); YY_RESULT_Explanation_= $$; }
  | _SYMB_2 {  $$ = new Noexplan(); YY_RESULT_Explanation_= $$; }
;
ListRule : /* empty */ {  $$ = new ListRule(); YY_RESULT_ListRule_= $$; }
  | ListRule Rule {  $1->push_back($2) ; $$ = $1 ; YY_RESULT_ListRule_= $$; }
;
Tag : _STRING_ {  $$ = new TTag($1); YY_RESULT_Tag_= $$; }
;
Severity : _SYMB_30 {  $$ = new SevInfo(); YY_RESULT_Severity_= $$; }
  | _SYMB_35 {  $$ = new SevWarning(); YY_RESULT_Severity_= $$; }
  | _SYMB_21 {  $$ = new SevCritical(); YY_RESULT_Severity_= $$; }
;
PathQuantifier : _SYMB_19 Expr {  $$ = new AG($2); YY_RESULT_PathQuantifier_= $$; }
  | _SYMB_18 Expr {  $$ = new AF($2); YY_RESULT_PathQuantifier_= $$; }
  | _SYMB_20 Expr {  $$ = new AX($2); YY_RESULT_PathQuantifier_= $$; }
  | _SYMB_17 Expr _SYMB_34 Expr {  $$ = new AU($2, $4); YY_RESULT_PathQuantifier_= $$; }
  | _SYMB_24 Expr {  $$ = new EG($2); YY_RESULT_PathQuantifier_= $$; }
  | _SYMB_23 Expr {  $$ = new EF($2); YY_RESULT_PathQuantifier_= $$; }
  | _SYMB_25 Expr {  $$ = new EX($2); YY_RESULT_PathQuantifier_= $$; }
  | _SYMB_22 Expr _SYMB_34 Expr {  $$ = new EU($2, $4); YY_RESULT_PathQuantifier_= $$; }
;
IAtom2 : _SYMB_44 {  $$ = new INrChildren(); YY_RESULT_IAtom_= $$; }
  | _SYMB_46 {  $$ = new IRow(); YY_RESULT_IAtom_= $$; }
  | _SYMB_36 {  $$ = new ICol(); YY_RESULT_IAtom_= $$; }
  | _SYMB_4 IAtom _SYMB_5 {  $$ = $2; YY_RESULT_IAtom_= $$; }
;
IAtom1 : _IDENT_ _SYMB_3 IAtom2 {  $$ = new IQuant($1, $3); YY_RESULT_IAtom_= $$; }
  | _INTEGER_ {  $$ = new IInt($1); YY_RESULT_IAtom_= $$; }
  | IAtom2 {  $$ = $1; YY_RESULT_IAtom_= $$; }
;
IAtom : IAtom1 {  $$ = $1; YY_RESULT_IAtom_= $$; }
;
SAtom3 : _SYMB_48 {  $$ = new SValue(); YY_RESULT_SAtom_= $$; }
  | _SYMB_49 {  $$ = new SValueType(); YY_RESULT_SAtom_= $$; }
  | _SYMB_43 {  $$ = new SNodeType(); YY_RESULT_SAtom_= $$; }
  | _SYMB_4 SAtom _SYMB_5 {  $$ = $2; YY_RESULT_SAtom_= $$; }
;
SAtom2 : _IDENT_ _SYMB_3 SAtom3 {  $$ = new SQuant($1, $3); YY_RESULT_SAtom_= $$; }
  | _STRING_ {  $$ = new SString($1); YY_RESULT_SAtom_= $$; }
  | SAtom3 {  $$ = $1; YY_RESULT_SAtom_= $$; }
;
SAtom1 : SAtom1 _SYMB_6 SAtom2 {  $$ = new SConcat($1, $3); YY_RESULT_SAtom_= $$; }
  | SAtom2 {  $$ = $1; YY_RESULT_SAtom_= $$; }
;
SAtom : SAtom1 {  $$ = $1; YY_RESULT_SAtom_= $$; }
;
Expr10 : _SYMB_33 {  $$ = new ETrue(); YY_RESULT_Expr_= $$; }
  | _SYMB_26 {  $$ = new EFalse(); YY_RESULT_Expr_= $$; }
  | _SYMB_4 Expr _SYMB_5 {  $$ = new EParant($2); YY_RESULT_Expr_= $$; }
  | _SYMB_4 Expr _SYMB_5 {  $$ = $2; YY_RESULT_Expr_= $$; }
;
Expr9 : _SYMB_7 Expr10 {  $$ = new ENot($2); YY_RESULT_Expr_= $$; }
  | Expr10 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr7 : Expr7 _SYMB_8 Expr8 {  $$ = new EBEq($1, $3); YY_RESULT_Expr_= $$; }
  | Expr8 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr6 : _STRING_ _SYMB_41 _SYMB_45 _SYMB_47 {  $$ = new EPossToken($1); YY_RESULT_Expr_= $$; }
  | _STRING_ _SYMB_41 _SYMB_38 _SYMB_47 {  $$ = new EExistToken($1); YY_RESULT_Expr_= $$; }
  | IAtom _SYMB_9 IAtom {  $$ = new EILtEq($1, $3); YY_RESULT_Expr_= $$; }
  | IAtom _SYMB_10 IAtom {  $$ = new EIGtEq($1, $3); YY_RESULT_Expr_= $$; }
  | IAtom _SYMB_11 IAtom {  $$ = new EILt($1, $3); YY_RESULT_Expr_= $$; }
  | IAtom _SYMB_12 IAtom {  $$ = new EIGt($1, $3); YY_RESULT_Expr_= $$; }
  | IAtom _SYMB_8 IAtom {  $$ = new EIEq($1, $3); YY_RESULT_Expr_= $$; }
  | SAtom _SYMB_42 _STRING_ {  $$ = new EMatch($1, $3); YY_RESULT_Expr_= $$; }
  | SAtom _SYMB_8 SAtom {  $$ = new ESEq($1, $3); YY_RESULT_Expr_= $$; }
  | Expr7 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr4 : Expr4 _SYMB_13 Expr5 {  $$ = new EAnd($1, $3); YY_RESULT_Expr_= $$; }
  | Expr4 _SYMB_14 Expr5 {  $$ = new EOr($1, $3); YY_RESULT_Expr_= $$; }
  | Expr5 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr3 : _SYMB_39 _IDENT_ _SYMB_40 ListFilter _SYMB_15 Expr {  std::reverse($4->begin(),$4->end()) ;$$ = new EForAllQ($2, $4, $6); YY_RESULT_Expr_= $$; }
  | _SYMB_37 _IDENT_ _SYMB_40 ListFilter _SYMB_15 Expr {  std::reverse($4->begin(),$4->end()) ;$$ = new EExistQ($2, $4, $6); YY_RESULT_Expr_= $$; }
  | PathQuantifier {  $$ = new EPQ($1); YY_RESULT_Expr_= $$; }
  | Expr4 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr2 : Expr2 _SYMB_16 Expr3 {  $$ = new EImpl($1, $3); YY_RESULT_Expr_= $$; }
  | Expr3 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr : Expr1 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr1 : Expr2 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr5 : Expr6 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
Expr8 : Expr9 {  $$ = $1; YY_RESULT_Expr_= $$; }
;
ListExpr : /* empty */ {  $$ = new ListExpr(); YY_RESULT_ListExpr_= $$; }
  | ListExpr Expr {  $1->push_back($2) ; $$ = $1 ; YY_RESULT_ListExpr_= $$; }
;
Filter : _STRING_ {  $$ = new FString($1); YY_RESULT_Filter_= $$; }
;
ListFilter : /* empty */ {  $$ = new ListFilter(); YY_RESULT_ListFilter_= $$; }
  | Filter {  $$ = new ListFilter() ; $$->push_back($1); YY_RESULT_ListFilter_= $$; }
  | Filter _SYMB_3 ListFilter {  $3->push_back($1) ; $$ = $3 ; YY_RESULT_ListFilter_= $$; }
;

